<div class="dashboard">
    <h1>Dashboard</h1>
    <div class="dashboard-grid">
        <div class="dashboard-card">
            <h3>Propriedades</h3>
            <p id="propertiesCount">Carregando...</p>
            <button onclick="navigate('/properties')" class="btn-primary">Gerenciar</button>
        </div>
        <div class="dashboard-card">
            <h3>Talhões</h3>
            <p id="plotsCount">Carregando...</p>
            <button onclick="navigate('/plots')" class="btn-primary">Gerenciar</button>
        </div>
    </div>
</div>

<script>
async function loadDashboard() {
    // Aguardar Supabase carregar
    while (!window.supabaseClient) {
        await new Promise(resolve => setTimeout(resolve, 100));
    }
    
    supabase = window.supabaseClient;

    // Carregar contadores
    try {
        const properties = await getProperties();
        const propertiesCountEl = document.getElementById('propertiesCount');
        if (propertiesCountEl) {
            propertiesCountEl.textContent = `${properties.length} propriedade(s)`;
        }
        
        const plots = await getPlots();
        const plotsCountEl = document.getElementById('plotsCount');
        if (plotsCountEl) {
            plotsCountEl.textContent = `${plots.length} talhão(ões)`;
        }
    } catch (error) {
        console.error('Erro ao carregar dashboard:', error);
    }
}

// Executar quando página carregar
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadDashboard);
} else {
    loadDashboard();
}

// Executar quando router carregar página
window.addEventListener('pageLoaded', () => {
    if (window.location.pathname === '/dashboard' || window.location.pathname === '/') {
        setTimeout(loadDashboard, 100);
    }
});
</script>

